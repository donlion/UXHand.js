"use strict";var UXHand=new function(){this.isIOS=function(){return navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1},this._synchronize=function(callback){var localData=JSON.parse(localStorage.getItem("UXHandData"));null==this._data.scores.left&&null==this._data.scores.right&&null==this._data.scores.both&&localData?(localData.current&&this.updateClass(localData.current),this._data=localData):localStorage.setItem("UXHandData",JSON.stringify(this._data)),callback&&callback()},this.compatibility=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},this.touchTest=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}},this.options=function(){var userOptions=window.UXHandOptions;var output={certainty:.2,cycleDelay:2e4,destroyClasses:!0,destroyData:!0,root:document.body,threshold:50,sessionThreshold:10};if(userOptions)try{for(var key in userOptions)output[key]=userOptions[key]}catch(e){}return output},this.cycle=function(){try{this._calc()}catch(e){}finally{var _data=this._data;if(this._domClasses(_data),this._synchronize(),UXHand.HeatMap){var data=this._last;data.start&&0!=data.start.pageX&&0!=data.start.pageY&&this.tracking.push({x:data.start.pageX,y:data.start.pageY,pageX:data.start.pageX,pageY:data.start.pageY-window.pageYOffset,count:5}),data.end&&0!=data.end[0].clientY&&0!=data.end[0].clientX&&this.tracking.push({x:data.end[0].clientX,y:data.end[0].clientY,pageX:data.end[0].pageX,pageY:data.end[0].pageY-window.pageYOffset,count:5}),0!=data.drag.length&&[].forEach.call(data.drag,function(drag,index){UXHand.tracking.push({x:drag.x,y:drag.y,pageX:drag.pageX,pageY:drag.pageY-window.pageYOffset,count:5})})}this.fireEvent("cycle"),this._last.move=!1,this._last.drag=[]}},this._setupListeners=function(){var rootElement=document.body;rootElement?(rootElement.addEventListener("touchstart",function(e){UXHand._events.touchstart(e)}),rootElement.addEventListener("touchend",function(e){UXHand._events.touchend(e)}),rootElement.addEventListener("touchmove",function(e){UXHand._events.touchmove(e)})):document.addEventListener("DOMContentLoaded",function(){UXHand._setupListeners()},!1)},this._events={touchstart:function(e){var dataObj=e;dataObj||(dataObj=e),UXHand._last.start=dataObj},touchend:function(e){var dataObj=e;dataObj||(dataObj=e),UXHand._last.end=dataObj.changedTouches,UXHand.cycle()},touchmove:function(e){UXHand._last.moved=!0,-1==UXHand._last.drag.indexOf(e)&&UXHand._last.drag.push({x:e.touches[0].clientY,y:e.touches[0].clientX,pageX:e.touches[0].pageX,pageY:e.touches[0].pageY-window.pageYOffset})}},this._calc=function(){if(this._last){var _last=this._last;var output=[];var pushHand=function(hand,session){"right"==hand?UXHand._data.scores.right++:UXHand._data.scores.left++,1==session&&UXHand.session().add(hand)};var vectors=[{y:_last.start.touches[0].clientY,x:_last.start.touches[0].clientX},{y:_last.end[0].clientY,x:_last.end[0].clientX}];var drag=function(output){output.push(vectors[0].y>vectors[1].y?"up":vectors[0].y==vectors[1].y?"horizontal":"down"),output.push(UXHand.isIOS()?vectors[0].x<vectors[1].x?"left":vectors[0].x==vectors[1].x?"vertical":"right":vectors[0].x<vectors[1].x?"right":vectors[0].x==vectors[1].x?"vertical":"left"),handSize(vectors[0],vectors[1])};var tap=function(output){vectors[0].x<area.w?pushHand("left"):vectors[0].x>area.w+area.x&&pushHand("right")};var handSize=function(){};var area=this.wireFrame.areas();if(_last.moved?(output.push("moveDetected"),drag(output)):(output.push("touch Detected"),tap(output)),output.indexOf("vertical")>-1)vectors[0].x<area.w?pushHand("left",!0):vectors[0].x>area.w+area.x&&pushHand("right",!0);else{var measurePath={left:0,right:0};[].forEach.call(_last.drag,function(drag,index){var position=_last.drag[index];if(_last.drag[index+1]){var nextPosition=_last.drag[index+1];nextPosition.x>position.x&&nextPosition.y<position.y?measurePath.right++:nextPosition.x<position.x&&nextPosition.y<position.y?measurePath.left++:nextPosition.x>position.x&&nextPosition.y>position.y?measurePath.left++:nextPosition.x<position.x&&nextPosition.y>position.y&&measurePath.right++}}),measurePath.left>measurePath.right?pushHand("left",!0):measurePath.right>measurePath.left&&pushHand("right",!0)}}},this.session=function(){var self=UXHand._session;var add=function(hand){self.hand==hand?self.count++:(self.hand=hand,self.count=1),sync()};var sync=function(){if(3==self.count){var html=document.querySelector("html"),htmlClass=html.className;var newClass=htmlClass.replace(" templeft","").replace(" tempright","");newClass+=" temp"+self.hand,html.className=newClass.trim(),UXHand.fireListeners("UXHand.temp"+self.hand)}};return{data:{hand:self.hand,count:self.count,threshold:self.threshold},add:add,sync:sync}},this._domClasses=function(_data){var count=_data.scores.left+_data.scores.right+_data.scores.both;if(_data&&!(count<this.options().threshold)){_data.scores.left>_data.scores.right*(1+this.options().certainty)?UXHand.updateClass("lefthand"):_data.scores.right>_data.scores.left*(1+this.options().certainty)&&UXHand.updateClass("righthand");var average=(_data.scores.right+_data.scores.left)/2;_data.scores.both>average&&UXHand.updateClass("bothhands")}},this.destroy=function(){return localStorage.removeItem("UXHandData"),UXHand._last={start:null,end:null,drag:[],moved:!1},!0},this.wireFrame=new function(){this.areas=function(){var gap=UXHand.options().certainty,x=screen.width*gap,w=screen.width/2-x/2;return{gap:gap,x:x,w:w}},this.errorGap=function(){var area=this.areas();return{x:[0,area.w+area.x]}}},this.updateClass=function(value){if(UXHand._data.current!=value){UXHand._data.current=value,UXHand.fireListeners("UXHand."+value);var classes=value.split(","),UXHandClasses=["lefthand","righthand","bothhands"];var html=document.querySelector("html"),htmlClass=html.className;var outputClasses=function(){return UXHandClasses.forEach(function(className){value.indexOf(className)>=0?-1==htmlClass.indexOf(className)&&(htmlClass+=" "+className):htmlClass=htmlClass.replace(" "+className,"")}),htmlClass};html.className=outputClasses()}},this.on=function(event,listenerFn){UXHand._listeners.push({event:event.toLowerCase(),callback:listenerFn})},this.off=function(event){[].forEach.call(UXHand._listeners,function(listener,index){listener.event==event.toLowerCase()&&UXHand._listeners.splice(listener,1)})},this.fireListeners=function(type){this.fireEvent(type),UXHand._listeners.length>0&&[].forEach.call(UXHand._listeners,function(listener,index){var listenerKeySplit=listener.event.split(".");var listenerKey=listenerKeySplit.length>2?listenerKeySplit.splice(0,listenerKeySplit.length-1).join("."):listenerKeySplit.join(".");if(listenerKey==type.toLowerCase())try{listener.callback()}catch(e){}})},this.fireEvent=function(type){var e;var eventName="UXHand."+type;document.createEvent?(e=document.createEvent("Event"),e.initEvent(eventName,!0,!1)):(e=document.createEventObject(),e.eventType=eventName),e.eventName=eventName,document.createElement?document.dispatchEvent(e):e.fireEvent("on"+eventName,e)},this._listeners=[],this.listeners=function(){return this._listeners},this.version="0.4",this.init=function(){this.compatibility()&&this.touchTest()&&this._synchronize(function(){UXHand._setupListeners(),UXHand.cycle()})},this._session={hand:null,count:0,threshold:this.options().sessionThreshold},this._data={scores:{left:null,right:null,both:null},current:null},this._last={start:null,end:null,drag:[],moved:!1},this.tracking=[]};UXHand.init();