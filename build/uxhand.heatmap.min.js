if(function(w){var heatmapFactory=function(){var store=function store(hmap){var _={data:[],heatmap:hmap};this.max=1,this.get=function(key){return _[key]},this.set=function(key,value){_[key]=value}};store.prototype={addDataPoint:function(x,y){if(!(0>x||0>y)){var me=this,heatmap=me.get("heatmap"),data=me.get("data");return data[x]||(data[x]=[]),data[x][y]||(data[x][y]=0),data[x][y]+=arguments.length<3?1:arguments[2],me.set("data",data),me.max<data[x][y]?(heatmap.get("actx").clearRect(0,0,heatmap.get("width"),heatmap.get("height")),void me.setDataSet({max:data[x][y],data:data},!0)):void heatmap.drawAlpha(x,y,data[x][y],!0)}},setDataSet:function(obj,internal){var me=this,heatmap=me.get("heatmap"),data=[],d=obj.data,dlen=d.length;if(heatmap.clear(),this.max=obj.max,heatmap.get("legend")&&heatmap.get("legend").update(obj.max),null!=internal&&internal){for(var one in d)if(void 0!==one)for(var two in d[one])void 0!==two&&heatmap.drawAlpha(one,two,d[one][two],!1)}else for(;dlen--;){var point=d[dlen];heatmap.drawAlpha(point.x,point.y,point.count,!1),data[point.x]||(data[point.x]=[]),data[point.x][point.y]||(data[point.x][point.y]=0),data[point.x][point.y]=point.count}heatmap.colorize(),this.set("data",d)},exportDataSet:function(){var me=this,data=me.get("data"),exportData=[];for(var one in data)if(void 0!==one)for(var two in data[one])void 0!==two&&exportData.push({x:parseInt(one,10),y:parseInt(two,10),count:data[one][two]});return{max:me.max,data:exportData}},generateRandomDataSet:function(points){var heatmap=this.get("heatmap"),w=heatmap.get("width"),h=heatmap.get("height");var randomset={},max=Math.floor(1e3*Math.random()+1);randomset.max=max;var data=[];for(;points--;)data.push({x:Math.floor(Math.random()*w+1),y:Math.floor(Math.random()*h+1),count:Math.floor(Math.random()*max+1)});randomset.data=data,this.setDataSet(randomset)}};var legend=function legend(config){this.config=config;var _={element:null,labelsEl:null,gradientCfg:null,ctx:null};this.get=function(key){return _[key]},this.set=function(key,value){_[key]=value},this.init()};legend.prototype={init:function(){var me=this,config=me.config,title=config.title||"Legend",position=config.position,offset=config.offset||10,gconfig=config.gradient,labelsEl=document.createElement("ul"),labelsHtml="",grad,element,gradient,positionCss="";me.processGradientObject(),positionCss+=position.indexOf("t")>-1?"top:"+offset+"px;":"bottom:"+offset+"px;",positionCss+=position.indexOf("l")>-1?"left:"+offset+"px;":"right:"+offset+"px;",element=document.createElement("div"),element.style.cssText="border-radius:5px;position:absolute;"+positionCss+"font-family:Helvetica; width:256px;z-index:10000000000; background:rgba(255,255,255,1);padding:10px;border:1px solid black;margin:0;",element.innerHTML="<h3 style='padding:0;margin:0;text-align:center;font-size:16px;'>"+title+"</h3>",labelsEl.style.cssText="position:relative;font-size:12px;display:block;list-style:none;list-style-type:none;margin:0;height:15px;",gradient=document.createElement("div"),gradient.style.cssText=["position:relative;display:block;width:256px;height:15px;border-bottom:1px solid black; background-image:url(",me.createGradientImage(),");"].join(""),element.appendChild(labelsEl),element.appendChild(gradient),me.set("element",element),me.set("labelsEl",labelsEl),me.update(1)},processGradientObject:function(){var me=this,gradientConfig=this.config.gradient,gradientArr=[];for(var key in gradientConfig)gradientConfig.hasOwnProperty(key)&&gradientArr.push({stop:key,value:gradientConfig[key]});gradientArr.sort(function(a,b){return a.stop-b.stop}),gradientArr.unshift({stop:0,value:"rgba(0,0,0,0)"}),me.set("gradientArr",gradientArr)},createGradientImage:function(){var me=this,gradArr=me.get("gradientArr"),length=gradArr.length,canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),grad;canvas.width="256",canvas.height="15",grad=ctx.createLinearGradient(0,5,256,10);for(var i=0;length>i;i++)grad.addColorStop(1/(length-1)*i,gradArr[i].value);ctx.fillStyle=grad,ctx.fillRect(0,5,256,10),ctx.strokeStyle="black",ctx.beginPath();for(var i=0;length>i;i++)ctx.moveTo((1/(length-1)*i*256>>0)+.5,0),ctx.lineTo((1/(length-1)*i*256>>0)+.5,0==i?15:5);return ctx.moveTo(255.5,0),ctx.lineTo(255.5,15),ctx.moveTo(255.5,4.5),ctx.lineTo(0,4.5),ctx.stroke(),me.set("ctx",ctx),canvas.toDataURL()},getElement:function(){return this.get("element")},update:function(max){var me=this,gradient=me.get("gradientArr"),ctx=me.get("ctx"),labels=me.get("labelsEl"),labelText,labelsHtml="",offset;for(var i=0;i<gradient.length;i++)labelText=max*gradient[i].stop>>0,offset=ctx.measureText(labelText).width/2>>0,0==i&&(offset=0),i==gradient.length-1&&(offset*=2),labelsHtml+='<li style="position:absolute;left:'+(((1/(gradient.length-1)*i*256||0)>>0)-offset+.5)+'px">'+labelText+"</li>";labels.innerHTML=labelsHtml}};var heatmap=function heatmap(config){var _={radius:40,blurRadius:15,element:{},canvas:{},acanvas:{},ctx:{},actx:{},legend:null,visible:!0,width:0,height:0,max:!1,gradient:!1,opacity:180,premultiplyAlpha:!1,bounds:{l:1e3,r:0,t:1e3,b:0},debug:!1};this.store=new store(this),this.get=function(key){return _[key]},this.set=function(key,value){_[key]=value},this.configure(config),this.init()};return heatmap.prototype={configure:function(config){var me=this,rout,rin;if(me.set("radius",config.radius||40),me.set("blurRadius",config.blurRadius||15),me.set("element",config.element instanceof Object?config.element:document.getElementById(config.element)),me.set("visible",null!=config.visible?config.visible:!0),me.set("max",config.max||!1),me.set("gradient",config.gradient||{0:"rgba(000,000,255,0)",.2:"rgba(000,000,255,1)",.4:"rgba(000,255,255,1)",.6:"rgba(000,255,000,1)",.8:"rgba(255,255,000,1)",1:"rgba(255,000,000,1)"}),me.set("opacity",parseInt(255/(100/config.opacity),10)||180),me.set("width",config.width||0),me.set("height",config.height||0),me.set("debug",config.debug),config.legend){var legendCfg=config.legend;legendCfg.gradient=me.get("gradient"),me.set("legend",new legend(legendCfg))}},resize:function(){var me=this,element=me.get("element"),canvas=me.get("canvas"),acanvas=me.get("acanvas");canvas.width=acanvas.width=me.get("width")||element.style.width.replace(/px/,"")||me.getWidth(element),this.set("width",canvas.width),canvas.height=acanvas.height=me.get("height")||element.style.height.replace(/px/,"")||me.getHeight(element),this.set("height",canvas.height)},init:function(){var me=this,canvas=document.createElement("canvas"),acanvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),actx=acanvas.getContext("2d"),element=me.get("element"),blurRadius=me.get("blurRadius");me.initColorPalette(),me.set("canvas",canvas),me.set("ctx",ctx),me.set("acanvas",acanvas),me.set("actx",actx),me.resize(),canvas.style.cssText=acanvas.style.cssText="position:absolute;top:0;left:0;z-index:10000000;",me.get("visible")||(canvas.style.display="none"),element.appendChild(canvas),me.get("legend")&&element.appendChild(me.get("legend").getElement()),me.get("debug")&&document.body.appendChild(acanvas),actx.shadowOffsetX=15e3,actx.shadowOffsetY=15e3,actx.shadowBlur=blurRadius},initColorPalette:function(){var me=this,canvas=document.createElement("canvas"),gradient=me.get("gradient"),ctx,grad,testData;canvas.width="1",canvas.height="256",ctx=canvas.getContext("2d"),grad=ctx.createLinearGradient(0,0,1,256),testData=ctx.getImageData(0,0,1,1),testData.data[0]=testData.data[3]=64,testData.data[1]=testData.data[2]=0,ctx.putImageData(testData,0,0),testData=ctx.getImageData(0,0,1,1),me.set("premultiplyAlpha",testData.data[0]<60||testData.data[0]>70);for(var x in gradient)grad.addColorStop(x,gradient[x]);ctx.fillStyle=grad,ctx.fillRect(0,0,1,256),me.set("gradient",ctx.getImageData(0,0,1,256).data)},getWidth:function(element){var width=element.offsetWidth;return element.style.paddingLeft&&(width+=element.style.paddingLeft),element.style.paddingRight&&(width+=element.style.paddingRight),width},getHeight:function(element){var height=element.offsetHeight;return element.style.paddingTop&&(height+=element.style.paddingTop),element.style.paddingBottom&&(height+=element.style.paddingBottom),height},colorize:function(x,y){var me=this,width=me.get("width"),radius=me.get("radius"),height=me.get("height"),actx=me.get("actx"),ctx=me.get("ctx"),x2=3*radius,premultiplyAlpha=me.get("premultiplyAlpha"),palette=me.get("gradient"),opacity=me.get("opacity"),bounds=me.get("bounds"),left,top,bottom,right,image,imageData,length,alpha,offset,finalAlpha;null!=x&&null!=y?(x+x2>width&&(x=width-x2),0>x&&(x=0),0>y&&(y=0),y+x2>height&&(y=height-x2),left=x,top=y,right=x+x2,bottom=y+x2):(left=bounds.l<0?0:bounds.l,right=bounds.r>width?width:bounds.r,top=bounds.t<0?0:bounds.t,bottom=bounds.b>height?height:bounds.b),image=actx.getImageData(left,top,right-left,bottom-top),imageData=image.data,length=imageData.length;for(var i=3;length>i;i+=4)alpha=imageData[i],offset=4*alpha,offset&&(imageData[i-3]=palette[offset],imageData[i-2]=palette[offset+1],imageData[i-1]=palette[offset+2],finalAlpha=palette[offset+3]*(opacity/255)|0,premultiplyAlpha&&(imageData[i-3]/=255/finalAlpha,imageData[i-2]/=255/finalAlpha,imageData[i-1]/=255/finalAlpha),imageData[i]=finalAlpha);image.data=imageData,ctx.putImageData(image,left,top)},drawAlpha:function(x,y,count,colorize){var me=this,radius=me.get("radius"),blurRadius=me.get("blurRadius"),ctx=me.get("actx"),max=me.get("max"),bounds=me.get("bounds"),xb=x-1.5*radius>>0,yb=y-1.5*radius>>0,xc=x+1.5*radius>>0,yc=y+1.5*radius>>0;ctx.shadowColor="rgba(0,0,0,"+(count?count/me.store.max:"0.1")+")",ctx.shadowOffsetX=15e3,ctx.shadowOffsetY=15e3,ctx.shadowBlur=blurRadius,ctx.beginPath(),ctx.arc(x-15e3,y-15e3,radius,0,2*Math.PI,!0),ctx.closePath(),ctx.fill(),colorize?me.colorize(xb,yb):(xb<bounds.l&&(bounds.l=xb),yb<bounds.t&&(bounds.t=yb),xc>bounds.r&&(bounds.r=xc),yc>bounds.b&&(bounds.b=yc))},toggleDisplay:function(){var me=this,visible=me.get("visible"),canvas=me.get("canvas");visible?canvas.style.display="none":canvas.style.display="block",me.set("visible",!visible)},getImageData:function(){return this.get("canvas").toDataURL()},clear:function(){var me=this,w=me.get("width"),h=me.get("height");me.store.set("data",[]),me.get("ctx").clearRect(0,0,w,h),me.get("actx").clearRect(0,0,w,h)},cleanup:function(){var me=this;me.get("element").removeChild(me.get("canvas"))}},{create:function(config){return new heatmap(config)},util:{mousePosition:function(ev){var x,y;return ev.layerX?(x=ev.layerX,y=ev.layerY):ev.offsetX&&(x=ev.offsetX,y=ev.offsetY),"undefined"!=typeof x?[x,y]:void 0}}}}();w.h337=w.heatmapFactory=heatmapFactory}(window),!UXHand)throw new Error("UXHand.js needed for the heatmap-plugin to work");UXHand.HeatMap=new function(){this.init=function(){this.createDOM(UXHand.HeatMap.initializeHeatMap)},this.createDOM=function(callback){var element=document.createElement("DIV");element.className="uxhand__heatmap",element.style.position="fixed",element.style.top="0px",element.style.left="0px",element.style.right="0px",element.style.bottom="0px",element.style.height=screen.height,element.innerHTML="<div class='uxhand__heatmap__container' style='height:"+screen.height+"px;'></div>",document.body.appendChild(element),callback&&setTimeout(function(){callback(element.children)},20)},this.initializeHeatMap=function(element){if(!h337)throw new Error("Heatmap plugin wasn't included. Please contact the developer of heatmap.js on github, if this isn't something you removed yourself.");var heatMapInstance=h337.create({element:document.querySelector(".uxhand__heatmap__container"),radius:15,opacity:50});var points=UXHand.tracking,max=0,width=screen.width,height=screen.height,len=200;var points=function(){var returnVal=[];return[].forEach.call(UXHand.tracking,function(tracking,index){returnVal.push({x:tracking.pageX,y:tracking.pageY,count:5})}),returnVal};var data={max:20,min:0,data:points()};heatMapInstance.store.setDataSet(data)}};